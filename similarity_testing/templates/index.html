<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Article & Text Similarity Analyzer</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      margin: 0;
      padding: 0;
    }
    header {
      background: #333;
      color: #fff;
      padding: 20px;
      text-align: center;
    }
    .container {
      width: 90%;
      max-width: 1000px;
      margin: 20px auto;
      background: #fff;
      padding: 20px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      position: relative;
    }
    input[type="text"], textarea, select {
      width: 100%;
      padding: 10px;
      font-size: 14px;
      margin-bottom: 20px;
      border: 1px solid #ccc;
      resize: vertical;
    }
    input[type="submit"], button {
      background: #333;
      color: #fff;
      border: none;
      padding: 12px 20px;
      font-size: 16px;
      cursor: pointer;
      margin-right: 10px;
    }
    input[type="submit"]:hover, button:hover {
      background: #555;
    }
    #results {
      margin-top: 40px;
    }
    /* Progress overlay styles */
    #progress-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      display: none;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      color: #fff;
      font-size: 20px;
    }
    .spinner {
      border: 8px solid #f3f3f3;
      border-top: 8px solid #3498db;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      animation: spin 2s linear infinite;
      margin-bottom: 20px;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <header>
    <h1>Article & Text Similarity Analyzer</h1>
  </header>
  <div class="container">
    <h2>Enter Article URLs</h2>
    <label for="url1"><strong>Article URL 1:</strong></label>
    <input type="text" id="url1" name="url1" placeholder="Enter first article URL...">
    <label for="url2"><strong>Article URL 2:</strong></label>
    <input type="text" id="url2" name="url2" placeholder="Enter second article URL...">
    <button id="get-articles-btn">Get Articles</button>
    
    <h2>Article Content (Editable)</h2>
    <label for="text1"><strong>Text 1:</strong></label>
    <textarea id="text1" name="text1" placeholder="Article 1 content will appear here..."></textarea>
    <label for="text2"><strong>Text 2:</strong></label>
    <textarea id="text2" name="text2" placeholder="Article 2 content will appear here..."></textarea>
    
    <h2>Analysis Options</h2>
    <label for="model_choice"><strong>Select Model:</strong></label>
    <select id="model_choice" name="model_choice">
      <option value="llama3.2">llama3.2</option>
      <option value="mistral">mistral</option>
    </select>
    <label for="guardrail_questions"><strong>Guardrail Questions (one per line):</strong></label>
    <textarea id="guardrail_questions" name="guardrail_questions" placeholder="Enter guardrail questions here...">{{ default_guardrails }}</textarea>
    <input type="submit" id="analyze-btn" value="Analyze">
    
    <div id="results"></div>
  </div>

  <!-- Progress Overlay -->
  <div id="progress-overlay">
    <div class="spinner"></div>
    <div id="progress-message">Initializing...</div>
  </div>

  <script>
    // Progress overlay functions (same as before)
    const progressMessages = [
      "Loading models... Hang tight while we initialize.",
      "Computing semantic similarity... Just a moment!",
      "Analyzing tone and style for Article 1... Almost there!",
      "Analyzing tone and style for Article 2... Please wait!",
      "Generating comparative analysis... Hold on tight!",
      "Classifying emotions... Almost finished!",
      "Running guardrail checks... Finalizing results..."
    ];
    let messageIndex = 0;
    let progressInterval = null;
    function startProgressUpdates() {
      const messageElement = document.getElementById("progress-message");
      progressInterval = setInterval(() => {
        messageIndex = (messageIndex + 1) % progressMessages.length;
        messageElement.textContent = progressMessages[messageIndex];
      }, 4000);
    }
    function stopProgressUpdates() {
      clearInterval(progressInterval);
      messageIndex = 0;
      document.getElementById("progress-message").textContent = progressMessages[0];
    }

    // AJAX for "Get Articles" button
    document.getElementById("get-articles-btn").addEventListener("click", function(e) {
      e.preventDefault();
      const url1 = document.getElementById("url1").value;
      const url2 = document.getElementById("url2").value;
      if (!url1 && !url2) {
        alert("Please enter at least one URL.");
        return;
      }
      // Show a simple overlay while fetching articles
      document.getElementById("progress-overlay").style.display = "flex";
      startProgressUpdates();
      const formData = new FormData();
      formData.append("url1", url1);
      formData.append("url2", url2);
      fetch("/get_articles", {
        method: "POST",
        body: formData
      })
      .then(response => response.json())
      .then(data => {
        stopProgressUpdates();
        document.getElementById("progress-overlay").style.display = "none";
        document.getElementById("text1").value = data.text1;
        document.getElementById("text2").value = data.text2;
      })
      .catch(error => {
        console.error("Error fetching articles:", error);
        stopProgressUpdates();
        document.getElementById("progress-overlay").style.display = "none";
        alert("An error occurred while fetching articles.");
      });
    });

    // AJAX for "Analyze" button (similar to before)
    document.getElementById("analyze-btn").addEventListener("click", function(e) {
      e.preventDefault();
      document.getElementById("progress-overlay").style.display = "flex";
      startProgressUpdates();
      const formData = new FormData();
      formData.append("text1", document.getElementById("text1").value);
      formData.append("text2", document.getElementById("text2").value);
      formData.append("model_choice", document.getElementById("model_choice").value);
      formData.append("guardrail_questions", document.getElementById("guardrail_questions").value);
      fetch("/analyze", {
        method: "POST",
        body: formData
      })
      .then(response => response.text())
      .then(html => {
        stopProgressUpdates();
        document.getElementById("progress-overlay").style.display = "none";
        document.getElementById("results").innerHTML = html;
      })
      .catch(error => {
        console.error("Error during analysis:", error);
        stopProgressUpdates();
        document.getElementById("progress-overlay").style.display = "none";
        document.getElementById("results").innerHTML = "<p style='color:red;'>An error occurred. Please try again.</p>";
      });
    });
  </script>
</body>
</html>